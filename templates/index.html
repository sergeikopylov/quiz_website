<!DOCTYPE html>
<html>
<head>
    <title>Buzzer Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            background-color: #2c3e50; /* Dark background */
            color: white;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* LOGIN SCREEN */
        #login-screen { display: flex; flex-direction: column; gap: 15px; }
        input { padding: 15px; font-size: 20px; border-radius: 5px; border: none; }
        .enter-btn { padding: 10px; font-size: 18px; cursor: pointer; background: #27ae60; color: white; border: none; }

        /* MAIN SCREEN */
        #main-screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }

        #status-text {
            font-size: 30px;
            margin-bottom: 20px;
            height: 40px;
        }

        /* THE BUTTON STATES */
        #the-button {
            width: 80%;
            height: 50vh;
            font-size: 40px;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            box-shadow: 0 10px 0 rgba(0,0,0,0.2);
        }

        /* 1. Neutral State (Ready) */
        .btn-ready { background-color: #27ae60; } /* Green */
        .btn-ready:active { transform: translateY(5px); box-shadow: 0 5px 0 rgba(0,0,0,0.2); }

        /* 2. Locked State (Someone else won) */
        .btn-locked { background-color: #7f8c8d; cursor: not-allowed; } /* Grey */

        /* 3. Winner State (You won!) */
        .btn-winner { background-color: #f1c40f; color: black; } /* Gold */

        /* SERGEI RESET BUTTON */
        .btn-sergei {
            width: auto !important;
            height: auto !important;
            padding: 20px 40px;
            background-color: #e74c3c; /* Red */
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1>Buzzer Login</h1>
        <input type="text" id="username" placeholder="Enter Name">
        <button class="enter-btn" onclick="enterApp()">Join Game</button>
    </div>

    <div id="main-screen">
        <div id="status-text">WAITING FOR CLICKS...</div>
        <button id="the-button" class="btn-ready" onclick="sendClick()">CLICK!</button>
    </div>

    <script>
        var socket = io();
        var currentUser = "";
        // Sound for when someone buzzes in
        var buzzSound = new Audio('https://cdn.freesound.org/previews/366/366104_6687700-lq.mp3');

        function enterApp() {
            var name = document.getElementById('username').value.trim();
            if (!name) return;
            currentUser = name;

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-screen').style.display = 'flex';

            // Special UI for Sergei
            if (currentUser === "Sergei") {
                var btn = document.getElementById('the-button');
                btn.innerText = "RESET CYCLE";
                btn.className = "btn-sergei";
            }
        }

        function sendClick() {
            // Send click to server
            socket.emit('user_clicked', {name: currentUser});
        }

        // EVENT: SOMEONE LOCKED THE BUTTON
        socket.on('game_locked', function(data) {
            var btn = document.getElementById('the-button');
            var status = document.getElementById('status-text');

            // Play sound
            buzzSound.currentTime = 0;
            buzzSound.play();

            if (currentUser === "Sergei") {
                // Sergei sees who won, but his button stays active (to reset)
                status.innerText = "LOCKED BY: " + data.winner;
                // We do NOT disable Sergei's button
            } else {
                if (data.winner === currentUser) {
                    // I won!
                    btn.className = "btn-winner";
                    btn.innerText = "YOU BUZZED IN!";
                    status.innerText = "YOU WON!";
                } else {
                    // Someone else won
                    btn.className = "btn-locked";
                    btn.innerText = "LOCKED";
                    btn.disabled = true; // Block clicks
                    status.innerText = "Winner: " + data.winner;
                }
            }
        });

        // EVENT: SERGEI RESET THE GAME
        socket.on('game_reset', function(data) {
            var btn = document.getElementById('the-button');
            var status = document.getElementById('status-text');

            status.innerText = "GO!";

            if (currentUser === "Sergei") {
                btn.innerText = "RESET CYCLE";
                // Sergei's button is always red/active
            } else {
                // Reset normal users to Green/Ready
                btn.className = "btn-ready";
                btn.innerText = "CLICK!";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>